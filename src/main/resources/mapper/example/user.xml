<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ez.launer.user.model.UserDAO">
	<!-- 회원가입 -->
	<insert id="insertUser" parameterType="userVo">
		<selectKey resultType="int" keyProperty="no" order="BEFORE">
			select users_seq.nextval from dual
		</selectKey>
		insert into users(no,user_code,name,email,pwd,hp,start_date,point)
		values(#{no},#{userCode},#{name},#{email},#{pwd},#{hp},sysdate,#{point})
	</insert>
	<!-- 가입시 주소 입력 -->
	<insert id="insertAddress" parameterType="userAddressVo">
		<selectKey resultType="int" keyProperty="no" order="BEFORE">
			select users_address_seq.nextval from dual
		</selectKey>
		insert into users_address(no, address, address_detail, zipcode)
		values(no, #{address}, #{addressDetail}, #{zipcode})
	</insert>
	<!-- 이메일 중복 확인 -->
	<select parameterType="String" id="chkEmail" resultType="int">
		select count(*) from users where Email=#{email} 
	</select>
	<!-- 휴대전화 번호 중복 확인 -->
	<select parameterType="String" id="chkHp" resultType="int">
		select count(*) from users where HP=#{hp}
	</select>
	<!-- 로그인 -->
	<select parameterType="string" id="selectByEmail" resultType="userVo">
		select * from users where email=#{email} 
	</select>
	<!-- 회원 정보 조회 -->
	<select id="selectById" parameterType="int" resultType="userVo">
		select * from users where no=#{no}
	</select>
	<!-- 회원 정보 조회 주소테이블 조인 -->
	<select id="selectByIdAddress" parameterType="int" resultType="hashMap">
		select u.*,a.address,a.entermethod,a.address_detail,a.zipcode 
		from users u, users_address a
		where u.no=a.users_no
		and u.no=#{no}
	</select>
	<!-- 회원 탈퇴처리 -->
	<update id="deleteUser" parameterType="int">
		update users set out_date=sysdate
		where no=#{no}
	</update>
	
	<!-- 회원정보 수정 비밀번호 체크 -->
	<select id="selectPwd" parameterType="int" resultType="String">
		select pwd from users
		where no=#{no} and out_date is null
	</select>
	<!-- 회원정보 수정 (전화번호)  -->
	<update id="updateUserHp" parameterType="userVo">
		update users
		set hp=#{hp} where no=#{no}
	</update>
	<!-- 회원정보 수정(주소) -->
	<update id="updateUserAddress" parameterType="userAddressVo">
		update users_address
		set address=#{address}, 
			address_detail=#{addressDetail}, 
			entermethod=#{entermethod}, 
			zipcode=#{zipcode},
			office_no = #{officeNo}
		where users_no=#{no}
	</update>
	<!-- 비밀번호 변경처리 -->
	<update id="editPwd" parameterType="userVo">
		update users 
		set pwd=#{pwd}
		where no=#{no}
	</update>
	<select id="selectUser" parameterType="int">	/*1:유저, 3~4:관리자*/
		select * from USERS
		<if test="no == 1">
			where USER_CODE = #{no}
		</if>
		<if test="no != 1">
			where USER_CODE >= #{no}
		</if>
	</select>

	<select id="selectDeliveryUser">
		select * from DELIVERY_DRIVER
	</select>
</mapper>